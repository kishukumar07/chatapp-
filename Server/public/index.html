<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat App</title>
</head>

<body>


    <h1>Chat App</h1>

    <form action="./chat.html">
        <input  name="name"  id="name" type="text" placeholder="Enter your Name ">
        <input   name="room" id="room" type="text" placeholder="Enter Room">
        <!-- <button  id="enter">Enter</button>  -->
        <input type="submit"  id="enter" >
        <!-- action on enter   -->
    </form>

    

    <div id="onlineusers">
        <!-- the div tells info about who joined and left -->
    </div>

    <!-- <div>
        <input type="text" id="message">
        <button id="send">Send</button>
    </div> -->




    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"
        integrity="sha384-mkQ3/7FUtcGyoppY6bz/PORYoGqOl7/aSUMn2ymDOJcapfS6PHqxhRTMh1RR0Q6+"
        crossorigin="anonymous"></script>



    <script>
        const socket = io("http://localhost:4500", { transports: ["websocket"] });

        const username = document.querySelector("#name");
        const room = document.querySelector("#room");
        const joinBtn = document.querySelector("#enter");

        const onlineusers = document.querySelector("#onlineusers");
        // console.log(onlineusers); 

        // const message = document.querySelector("#message");
        // const sendBtn = document.querySelector('#send'); 
        // console.log(message);


        joinBtn.addEventListener("click", () => {
            let user = { name: username.value, room: room.value };
            console.log(user, "From clientSide");
            socket.emit("join-room", user);

            //we want to redirect user into another chat.html page 

            // window.location.href = "chat.html";   //if this executed immediately then all broadcast is not working ....  can be done further......

        })



        socket.on("new-user-joined", (user) => {
            // console.log(user, "broadcasting byevent at clientside ");
            alert(`${user} joined the room.`);
        }); 



        socket.on("room-users", (allusers) => {
            // console.log(allusers);
            onlineusers.innerHTML = null;

            allusers.forEach((user) => {
                let li = document.createElement("li");
                li.textContent = user.name; // Use textContent for security
                onlineusers.append(li)
            })

        }); 


        socket.on("user-left", (user) => {
            alert(`${user} lefted the room`);
        }); 


        
        // sendBtn.addEventListener("click",()=>{
        //     let message =message.value; 
        //     socket.emit("send-message",message)
        // })







    </script>










</body>

</html>