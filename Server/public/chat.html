<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatRoom</title>
</head>

<body>


    <h3 class="room-message"></h3>

    <div class="box">
        <div class="online">
          <p class="users-online">Users Online</p>
          <div class="users"></div>
        </div>
        <div class="window">
          <div class="fields">
            <input type="text" id="message" placeholder="Enter message" />
            <button id="send">Send</button>
          </div>
          <div class="chat-message">
            <div id="output"></div>
            <div id="feedback"></div>
          </div>
          <div id="messageContainer"></div>
        </div>
      </div>


      <!-- have to mergee  this div -->
          <div id="onlineusers">
              <h3>onlineusers</h3>
          </div>
      
         <!-- have to mergee  this div -->
          <div id="message">
              <h2>chats section</h2>
          </div>
          

    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"
        integrity="sha384-mkQ3/7FUtcGyoppY6bz/PORYoGqOl7/aSUMn2ymDOJcapfS6PHqxhRTMh1RR0Q6+" crossorigin="anonymous">
        </script>






    <script>



        const socket = io("http://localhost:4500", { transports: ["websocket"] });


        const queries = window.location.search;
        const urlParams = new URLSearchParams(queries); //this 
        const username = urlParams.get("name");
        const room = urlParams.get("room");
        let user = { name: username, room };
        // console.log(user, "From clientSide");
        socket.emit("join-room", user);


        // joinBtn.addEventListener("click", () => {
        //     let user = { name: username.value, room: room.value };
        //     console.log(user, "From clientSide");
        // socket.emit("join-room", user); 

        //     //we want to redirect user into another chat.html page 

        //     // window.location.href = "chat.html";   //if this executed immediately then all broadcast is not working ....  can be done further......
        // })


        const onlineusers = document.querySelector("#onlineusers");


        socket.on("new-user-joined", (user) => {
            alert(`${user} joined the room.`);
        });



        socket.on("room-users", (allusers) => {

            onlineusers.innerHTML = null;

            allusers.forEach((user) => {
                let li = document.createElement("li");
                li.textContent = user.name; // Use textContent for security
                onlineusers.append(li)
            })

        });


        socket.on("user-left", (user) => {
            alert(`${user} lefted the room`);
        });



        // sendBtn.addEventListener("click",()=>{
        //     let message =message.value;
        //     socket.emit("send-message",message)
        // })


    </script>

</body>

</html>